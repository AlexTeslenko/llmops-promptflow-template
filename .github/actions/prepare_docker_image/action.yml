name: prep_docker_image

description: Creates a new docker images for PF deployment

inputs:
  FLOW_TO_EXECUTE:
    description: "the flow to be registered and deployed"
    required: true
  DEPLOY_ENVIRONMENT:
    description: "env stage e.g. dev, test, prod"
    required: true
  CONNECTION_DETAILS:
    description: "pf connection details"
    required: true
  REGISTRY_DETAILS:
    description: "docker image registry details"
    required: true

env:
  flow_to_execute: ${{ inputs.FLOW_TO_EXECUTE }}
  deploy_environment: ${{ inputs.DEPLOY_ENVIRONMENT }}
  connection_details: ${{ inputs.CONNECTION_DETAILS }}
  registry_details: ${{ inputs.REGISTRY_DETAILS }}
  build_id: ${{ github.run_id }}

runs:
  using: composite
  steps:
    - name: create docker image
      shell: bash
      run: sh ./llmops/common/scripts/gen_docker_image.sh
  		env:
    	  flow_to_execute: "${{ env.flow_to_execute }}"
        deploy_environment: "${{ env.deploy_environment }}"
        connection_details: "${{ env.connection_details }}"
        registry_details: "${{ env.registry_details }}"
        build_id: "${{ env.build_id }}"